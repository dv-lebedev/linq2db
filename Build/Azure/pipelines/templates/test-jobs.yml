parameters:
- name: enabled
  type: boolean
  default: false
- name: experimental
  type: boolean
  default: false

jobs:
##############################################################################################
#  Tests: Windows (NETFX 4.6)                                                                #
#  Windows 2019 (for Win2019 docker images, chocolatey-dependent tests and non-docker tests) #
##############################################################################################
- job: test_win_netfx46_job_2019
  pool:
    vmImage: 'windows-2019'
  displayName: 'Tests: Win / NETFX 4.6 / '
  dependsOn: build_job
  condition: eq(variables['System.PullRequest.TargetBranch'], 'release')

  strategy:
    matrix:
    - template: test-matrix-windows.yml
      parameters:
        version: '46'
        experimental: ${{ parameters. experimental }}
        os_version: '2019'

  steps:
  - template: test-workflow-windows.yml
    parameters:
      isCore: false
      artifacts: $(netfx46_tests)
      framework: '.NETFramework,Version=v4.6'
      titleFramework: 'NET46'

#############################################
#  Tests: Windows (NETFX 4.6)               #
#  Windows 2016 (for Win2016 docker images) #
#############################################
- job: test_win_netfx46_job_2016
  pool:
    vmImage: 'vs2017-win2016'
  displayName: 'Tests: Win / NETFX 4.6 / '
  dependsOn: build_job
  condition: eq(variables['System.PullRequest.TargetBranch'], 'release')

  strategy:
  - template: test-matrix-windows.yml
    parameters:
      version: '46'
      experimental: ${{ parameters. experimental }}
      os_version: '2016'

  steps:
  - template: test-workflow-windows.yml
    parameters:
      isCore: true
      artifacts: $(netfx46_tests)
      framework: '.NETFramework,Version=v4.6'
      titleFramework: 'NET46'

###################################
#  Tests: Windows (NETCOREAPP2_1) #
#  Windows 2016                   #
###################################
- job: test_win2016_netcoreapp21_job
  pool:
    vmImage: 'vs2017-win2016'
  displayName: 'Tests: Win / NETCOREAPP2.1 / '
  dependsOn: build_job
  condition: eq(variables['System.PullRequest.TargetBranch'], 'release')

  strategy:
  - template: test-matrix-windows.yml
    parameters:
      version: '2.1'
      experimental: ${{ parameters. experimental }}
      os_version: '2016'

  steps:
  - template: test-workflow-windows.yml
    parameters:
      isCore: true
      artifacts: $(netcore21_tests)
      framework: '.NETCoreApp,Version=v2.1'
      titleFramework: 'NETCOREAPP2.1'

###################################
#  Tests: Windows (NETCOREAPP3_1) #
#  Windows 2016                   #
###################################
- job: test_win2016_netcoreapp31_job
  pool:
    vmImage: 'vs2017-win2016'
  displayName: 'Tests: Win / NETCOREAPP3.1 / '
  dependsOn: build_job
  condition: eq(variables['System.PullRequest.TargetBranch'], 'release')

  strategy:
  - template: test-matrix-windows.yml
    parameters:
      version: '3.1'
      experimental: ${{ parameters. experimental }}
      os_version: '2016'

  steps:
  - template: test-workflow-windows.yml
    parameters:
      isCore: true
      artifacts: $(netcore31_tests)
      framework: '.NETCoreApp,Version=v3.1'
      titleFramework: 'NETCOREAPP3.1'

###################################
#  Tests: Windows (NETCOREAPP2_1) #
#  Windows 2019                   #
###################################
- job: test_win2019_netcoreapp21_job
  pool:
    vmImage: 'windows-2019'
  displayName: 'Tests: Win / NETCOREAPP2.1 / '
  dependsOn: build_job
  condition: eq(variables['System.PullRequest.TargetBranch'], 'release')

  strategy:
  - template: test-matrix-windows.yml
    parameters:
      version: '2.1'
      experimental: ${{ parameters. experimental }}
      os_version: '2019'

  steps:
  - template: test-workflow-windows.yml
    parameters:
      isCore: true
      artifacts: $(netcore21_tests)
      framework: '.NETCoreApp,Version=v2.1'
      titleFramework: 'NETCOREAPP2.1'

########################################
#  Tests: Ubuntu 20.04 (NETCOREAPP2_1) #
########################################
- job: test_ubuntu_20_netcoreapp21_job
  pool:
    vmImage: 'ubuntu-20.04'
  displayName: 'Tests: Lin / NETCOREAPP2.1 / '
  dependsOn: build_job
  condition: eq(variables['System.PullRequest.TargetBranch'], 'release')

  strategy:
  - template: test-matrix-linux.yml
    parameters:
      version: '2.1'
      experimental: ${{ parameters. experimental }}
      os_version: '20'

  steps:
  - template: test-workflow-linux.yml
    parameters:
      artifacts: $(netcore21_tests)
      netcoreversion: '2.1'

########################################
#  Tests: Ubuntu 20.04 (NETCOREAPP3_1) #
########################################
- job: test_ubuntu_20_netcoreapp31_job
  pool:
    vmImage: 'ubuntu-20.04'
  displayName: 'Tests: Lin / NETCOREAPP3.1 / '
  dependsOn: build_job
  condition: eq(variables['System.PullRequest.TargetBranch'], 'release')

  strategy:
  - template: test-matrix-linux.yml
    parameters:
      version: '3.1'
      experimental: ${{ parameters. experimental }}
      os_version: '20'

  steps:
  - template: test-workflow-linux.yml
    parameters:
      artifacts: $(netcore31_tests)
      netcoreversion: '3.1'

########################################
#  Tests: Ubuntu 16.04 (NETCOREAPP2_1) #
########################################
- job: test_ubuntu_16_netcoreapp21_job
  pool:
    vmImage: 'ubuntu-16.04'
  displayName: 'Tests: Lin / NETCOREAPP2.1 / '
  dependsOn: build_job
  condition: eq(variables['System.PullRequest.TargetBranch'], 'release')

  strategy:
  - template: test-matrix-linux.yml
    parameters:
      version: '2.1'
      experimental: ${{ parameters. experimental }}
      os_version: '16'

  steps:
  - template: test-workflow-linux.yml
    parameters:
      artifacts: $(netcore21_tests)
      netcoreversion: '2.1'

#################################
#  Tests: MacOS (NETCOREAPP2_1) #
#################################
- job: test_macos_netcoreapp21_job
  pool:
    vmImage: 'macOS-10.15'
  displayName: 'Tests: Mac / NETCOREAPP2.1 / '
  dependsOn: build_job
  condition: eq(variables['System.PullRequest.TargetBranch'], 'release')

  strategy:
  - template: test-matrix-macos.yml
    parameters:
      version: '2.1'
      experimental: ${{ parameters. experimental }}

  steps:
  - template: test-workflow-macos.yml
    parameters:
      artifacts: $(netcore21_tests)
      netcoreversion: '2.1'

#################################
#  Tests: MacOS (NETCOREAPP3_1) #
#################################
- job: test_macos_netcoreapp31_job
  pool:
    vmImage: 'macOS-10.15'
  displayName: 'Tests: Mac / NETCOREAPP3.1 / '
  dependsOn: build_job
  condition: eq(variables['System.PullRequest.TargetBranch'], 'release')

  strategy:
  - template: test-matrix-macos.yml
    parameters:
      version: '3.1'
      experimental: ${{ parameters. experimental }}

  steps:
  - template: test-workflow-macos.yml
    parameters:
      artifacts: $(netcore31_tests)
      netcoreversion: '3.1'
